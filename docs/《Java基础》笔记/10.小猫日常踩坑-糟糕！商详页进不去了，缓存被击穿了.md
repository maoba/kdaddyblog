---
title: 小猫日常踩坑-糟糕！商详页进不去了，缓存被击穿了
date: 2024-01-17 21:44:53
permalink: /pages/64ee6c/
categories:
  - 《Java基础》笔记
titleTag: 原创    
tags:
  - 缓存穿透
author: 
  name: 老猫
  link: https://github.com/maoba
---
## 故事
对于小猫来讲，最近的一段日子是不好过的，纵使听着再有节拍的音乐，也换不起他对生活的热情。由于上一次“幂等事件”躺枪，他已经有几天没有休息好了。他感觉人生到了低谷。

当接手这个商城项目之后，他感觉他一直没有好过。他的内心彷徨，在工位上边写着事故报告，边嘀咕着“今年到底是犯了啥冲...为什么...”

然而屋漏又遭连夜雨，船破偏遇当头风，好像坏事儿又找上了他。

坐他旁边的哥们在一旁抱怨，“啥情况，我就想给公司助助力，买点咱自家公司的产品，咋商详页咋点来点去进不了，你看看你的呢？”。

“你自己手机不行了吧，你瞧你那老破烂也该换了，iphone15 pmax搞起...” 旁边的老六开涮道。

然而却触动了小猫的神经，他赶紧打开app，发现自己的也进不去了。他赶紧打开Grafana，脸色苍白，口干舌燥....数据库连接全部打满。

不到一会组长的电话也收到了客服反馈的客诉，组长向小猫投来质疑的目光。

小猫无辜而又无奈：“我真的没有动过代码......”。

经过一轮彻彻底底的摸排，事情的原因也终于水落石出。

<!-- more -->

大概如下图这么回事儿：

![流程](https://cdn.ktdaddy.com/architecture/cache/cache_miss.png)

上次A公司对接商城服务之后开始在他们商城平台推拼团售卖活动，活动中的几个商品的缓存被删除之后没有恢复，原因是因为第三方对接的API商品大量推送，队列有堆积，导致redis缓存并没有及时更新。大批量的用户在进行购买活动商品的时候，请求全部打到了DB上。

反正也不晓得是哪个挨千刀的设计的技术方案，缓存到redis中的时候用的居然是异步消息队列。商品发布量小，访问量小的时候可能没有什么问题。

但是偏偏各种巧合发生在了一起就产生了这样一个事故，这可能就是所谓的墨菲定律吧。

小猫已经走到了绝望的边缘......（下次就不说小猫踩坑了，让他缓几天，哈哈）

## 聊聊缓存击穿
借此案例，接下来老猫和大家一起聊聊缓存击穿雪崩的话题。





